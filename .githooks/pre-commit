#!/bin/bash

set -e

echo "Running pre-commit checks..."

# Run gofmt
echo "Checking formatting..."
UNFORMATTED=$(gofmt -l .)
if [ -n "$UNFORMATTED" ]; then
    echo "Error: The following files are not formatted:"
    echo "$UNFORMATTED"
    echo ""
    echo "Run 'gofmt -w .' to fix formatting."
    exit 1
fi

# Run golangci-lint
echo "Running linter..."
if command -v golangci-lint &> /dev/null; then
    golangci-lint run ./...
else
    echo "Warning: golangci-lint not installed, skipping lint check"
fi

# Run tests
echo "Running tests..."
go test ./...

echo "All pre-commit checks passed!"
